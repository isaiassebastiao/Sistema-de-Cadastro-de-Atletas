<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Atletas</title>
<style>
    *{
        margin: 0;
        box-sizing: border-box;
        user-select: none;
    }
    body{
        font-family: Arial, Helvetica, sans-serif;
    }
    .wrapper, .section-1, form{
        display: flex;
        flex-flow: column nowrap;
    }
    .wrapper h1{
        font-size: 25pt;
    }
    .section-1{
        padding: 30px;
        text-align: center;
        align-items: center;    
    }
    p{
        width: 600px;
    }
    form{
        background-color: whitesmoke;
        width: 320px;
        height: 340px;
        gap: 20px;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        border: 1px solid rgba(0,0,0,0.1);
    }
    form input[type="text"], form input[type="date"], select{
        text-indent: 10px;
        width: 200px;
    }
    form input, select{
        outline: none;
        border-radius: 6px;
        height: 40px;
        border: 1px solid #acacac;
    }
    label{
        font-size: 11pt;
    }

    input{
        background-color: white;
        transition: .4s ease;
    }
    input[type="submit"]:hover{
        cursor: pointer;
        background-color: rgb(205, 205, 205);
    }

    .section-2{
        margin-top: 40px;
        display: flex;
        justify-content: center;
        gap: 40px;
        flex-flow: row wrap;
    }
    table{
        border-collapse: collapse;
        background-color: whitesmoke;
        margin-bottom: 40px;
    }
    th{
        background-color: rgb(218, 218, 218);
    }
    tr,td, th{
        padding: 10px;
        border: 1px solid #a5a5a5;
        text-align: center;
    }


</style>
</head>
<body>
    <div class="wrapper">
        <section class="section-1">
            <h1>Sistema de Cadastro de Atletas</h1>
            <p>Cadastre um jogador em nosso sistema no formulário abaixo e nós vamos nos encarregar de indexá-lo para o clube mais próximo.</p>
        </section>
        <section class="section-2">
            <div>
                <form>
                    <h3>Cadastrar Jogador</h3>
                    <div><input type="text" required placeholder="informe o nome do atleta" name="nome" autocomplete="off"></div>
                    <div>
                        <div>
                            <label for="opts">informe o municipio do atleta</label>
                        </div>
                        <select name="municipio" required id="opts">
                            <option value="Luanda">Luanda</option>
                            <option value="Cacuaco">Cacuaco</option>
                            <option value="Lobito">Lobito</option>
                            <option value="Viana">Viana</option>
                            <option value="Benguela">Benguela</option>
                            <option value="Uíge">Uíge</option>
                            <option value="Soyo">Soyo</option>
                            <option value="Lubango">Lubango</option>
                            <option value="Malanje">Malange</option>
                            <option value="Huambo">Huambo</option>
                            <option value="Outro">Outro</option>
                        </select>
                    </div>
                    <div style="text-align: center;">
                        <div>
                            <label for="data">Sua data de nascimento</label>
                        </div>
                        <input type="date" required name="data-nascimento" id="data">
                    </div>
                    <div><input type="submit" value="cadastrar"></div>
                </form>
            </div>
            <div>
                
                <table>
                    <thead>
                        <tr>
                            <th colspan="6">Atletas</th>
                        </tr>
                        <tr>
                            <th>Nome</th>
                            <th>Morada(município)</th>
                            <th>Nivel de Equipa</th>
                            <th>Clube</th>
                            <th>Município do Clube</th>
                            <th>Data de Nascimento</th>
                        </tr>
                    </thead>
                    <tbody>
                        
                    </tbody>
                </table>
            </div>
        </section>
    </div>
</body>
</html>
<script>
    const form = document.querySelector('form');
    form.addEventListener('submit', async event=>{
        event.preventDefault();
        const formData = new FormData(form);

        try{
            const response = await fetch('index.php?api=1',{
                method:'POST',
                body:formData
            });
        
            console.log(Object.fromEntries(formData));
            const jsonResponse = await response.json();
            console.log(jsonResponse);
            if(jsonResponse.message){
                alert(jsonResponse.message);
                setTimeout(()=>{
                    window.location.reload();
                },2000);
            }
        }catch(err){
            console.error(err);
        }

    });

    window.addEventListener('load', async()=>{
        try{
            const response = await fetch('index.php?api=1');
            const jsonResponse = await response.json();

            const tbody = document.querySelector('tbody');
            if(jsonResponse.success == false){
                document.body.innerHTML = `<h1 style="text-align:center; margin-top:20%;">${jsonResponse.message}</h1>`;   
            }
            else if(jsonResponse.success){
                tbody.innerHTML = ``;
                jsonResponse.data.forEach(element=>{
                    tbody.innerHTML += `
                                    <tr>
                                        <td>${element.nome}</td>
                                        <td>${element.municipio}</td>
                                        <td>${element.categoria}</td>
                                        <td>${element.clube}</td>
                                        <td>${element.clube_municipio}</td>
                                        <td>${element.data_nascimento}</td>
                                    </tr>
                                    `;
                });
            }
        }catch(err){
            console.error(err);
        }
    });
</script>